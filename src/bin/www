#!/usr/bin/env node
require("dotenv").config();
const app = require("../../index");
const connectDB = require("../config/database");

const PORT = process.env.PORT || 3000;
console.log("Starting server...");

const startServer = async () => {
  try {
    await Promise.race([
      connectDB(),
      new Promise((_, reject) =>
        setTimeout(() => reject(new Error("MongoDB connection timeout")), 10000)
      ),
    ]);
    console.log("âœ… Connected to MongoDB");

    app.listen(PORT, () => {
      console.log(`ğŸš€ Server listening on PORT ${PORT}`);
    });
  } catch (err) {
    console.error("âŒ Failed to connect to MongoDB", err);
    process.exit(1);
  }
};

startServer();

console.log(`ğŸŒ Running in ${process.env.NODE_ENV || "development"} mode`); //TODO Remove this line
// console.log(`ğŸ“¡ MongoDB URL: ${process.env.MONGO_URI ? "Defined" : "Not set"}`); //TODO 
